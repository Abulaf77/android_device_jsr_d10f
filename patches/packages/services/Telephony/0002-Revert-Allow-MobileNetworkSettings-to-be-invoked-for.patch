From 0680e5cc785ddd417764cdad9de45cce86679434 Mon Sep 17 00:00:00 2001
From: S-trace <S-trace@list.ru>
Date: Tue, 12 Jan 2016 02:14:49 +0300
Subject: [PATCH 2/2] Revert "Allow MobileNetworkSettings to be invoked for
 selected SIM."

This reverts commit 623872c77f4d264851aa1e3abb7342219959c036.
---
 res/values/cm_strings.xml                        |  2 --
 src/com/android/phone/MobileNetworkSettings.java | 31 ++++++------------------
 2 files changed, 7 insertions(+), 26 deletions(-)

diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
index b7204a4..01c085c 100644
--- a/res/values/cm_strings.xml
+++ b/res/values/cm_strings.xml
@@ -200,6 +200,4 @@
     <string name="exportAllcontatsSuccess">Succesfully exported all contacts to SIM</string>
     <string name="exportAllcontatsFailed">Failed to export all contacts to SIM</string>
     <string name="exportAllcontatsNoContacts">No contacts found to export to SIM</string>
-
-    <string name="msim_mobile_network_settings_title">SIM %d mobile network settings</string>
 </resources>
diff --git a/src/com/android/phone/MobileNetworkSettings.java b/src/com/android/phone/MobileNetworkSettings.java
index f0562f6..baaa46d 100644
--- a/src/com/android/phone/MobileNetworkSettings.java
+++ b/src/com/android/phone/MobileNetworkSettings.java
@@ -261,32 +261,12 @@ public class MobileNetworkSettings extends PreferenceActivity
         }
     }
 
-    private List<SubscriptionInfo> determineSubscriptionsToUse() {
-        int slotIndex = getIntent().getIntExtra(PhoneConstants.SLOT_KEY,
-                SubscriptionManager.INVALID_SIM_SLOT_INDEX);
-        int subId = getIntent().getIntExtra(PhoneConstants.SUBSCRIPTION_KEY,
-                SubscriptionManager.INVALID_SUBSCRIPTION_ID);
-        if (subId != SubscriptionManager.INVALID_SUBSCRIPTION_ID) {
-            setTitle(getString(R.string.msim_mobile_network_settings_title, slotIndex + 1));
-            SubscriptionInfo sir = mSubscriptionManager.getActiveSubscriptionInfo(subId);
-            ActionBar actionBar = getActionBar();
-            if (actionBar != null && sir != null) {
-                actionBar.setSubtitle(sir.getDisplayName());
-            }
-
-            List<SubscriptionInfo> infos = new ArrayList<SubscriptionInfo>();
-            infos.add(sir);
-            return infos;
-        }
-        return mSubscriptionManager.getActiveSubscriptionInfoList();
-    }
-
     private final SubscriptionManager.OnSubscriptionsChangedListener mOnSubscriptionsChangeListener
             = new SubscriptionManager.OnSubscriptionsChangedListener() {
         @Override
         public void onSubscriptionsChanged() {
             if (DBG) log("onSubscriptionsChanged:");
-            List<SubscriptionInfo> newSil = determineSubscriptionsToUse();
+            List<SubscriptionInfo> newSil = mSubscriptionManager.getActiveSubscriptionInfoList();
             if (DBG) log("onSubscriptionsChanged: newSil: " + newSil +
                     " mActiveSubInfos: " + mActiveSubInfos);
             if (newSil == null) {
@@ -327,11 +307,15 @@ public class MobileNetworkSettings extends PreferenceActivity
 
         // Before updating the the active subscription list check
         // if tab updating is needed as the list is changing.
-        List<SubscriptionInfo> sil = determineSubscriptionsToUse();
+        List<SubscriptionInfo> sil = mSubscriptionManager.getActiveSubscriptionInfoList();
         // Display all tabs according to configuration in Multi Sim mode
         TelephonyManager tm = (TelephonyManager) getSystemService(
                 Context.TELEPHONY_SERVICE);
-        TabState state = isUpdateTabsNeeded(sil);
+        int phoneCount = tm.getPhoneCount();
+        TabState state = TabState.UPDATE;
+        if (phoneCount < 2) {
+            state = isUpdateTabsNeeded(sil);
+        }
 
         // Update to the active subscription list
         mActiveSubInfos.clear();
@@ -346,7 +330,6 @@ public class MobileNetworkSettings extends PreferenceActivity
         switch (state) {
             case UPDATE: {
                 if (DBG) log("initializeSubscriptions: UPDATE");
-                int phoneCount = tm.getPhoneCount();
                 currentTab = mTabHost != null ? mTabHost.getCurrentTab() : 0;
 
                 setContentView(com.android.internal.R.layout.common_tab_settings);
-- 
2.5.0

