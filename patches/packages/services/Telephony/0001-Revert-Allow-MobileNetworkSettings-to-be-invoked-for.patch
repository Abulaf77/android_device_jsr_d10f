From ec3928e90c9765d2aaaf2d148e10da9d96490a18 Mon Sep 17 00:00:00 2001
From: S-trace <S-trace@list.ru>
Date: Thu, 4 Feb 2016 20:08:05 +0300
Subject: [PATCH] Revert "Allow MobileNetworkSettings to be invoked for
 selected SIM."

This reverts commit 623872c77f4d264851aa1e3abb7342219959c036.

Change-Id: I61f14ff837a5108222fe8d42176327127ebc82de
---
 src/com/android/phone/MobileNetworkSettings.java | 32 ++++++------------------
 1 file changed, 7 insertions(+), 25 deletions(-)

diff --git a/src/com/android/phone/MobileNetworkSettings.java b/src/com/android/phone/MobileNetworkSettings.java
index 688cb4c..586fa6d 100755
--- a/src/com/android/phone/MobileNetworkSettings.java
+++ b/src/com/android/phone/MobileNetworkSettings.java
@@ -261,34 +261,12 @@ public class MobileNetworkSettings extends PreferenceActivity
         }
     }
 
-    private List<SubscriptionInfo> determineSubscriptionsToUse() {
-        int slotIndex = getIntent().getIntExtra(PhoneConstants.SLOT_KEY,
-                SubscriptionManager.INVALID_SIM_SLOT_INDEX);
-        int subId = getIntent().getIntExtra(PhoneConstants.SUBSCRIPTION_KEY,
-                SubscriptionManager.INVALID_SUBSCRIPTION_ID);
-        if (subId != SubscriptionManager.INVALID_SUBSCRIPTION_ID) {
-            setTitle(getString(R.string.msim_mobile_network_settings_title, slotIndex + 1));
-            SubscriptionInfo sir = mSubscriptionManager.getActiveSubscriptionInfo(subId);
-            ActionBar actionBar = getActionBar();
-            if (actionBar != null && sir != null) {
-                actionBar.setSubtitle(sir.getDisplayName());
-            }
-
-            List<SubscriptionInfo> infos = new ArrayList<SubscriptionInfo>();
-            if (sir != null) {
-                infos.add(sir);
-            }
-            return infos;
-        }
-        return mSubscriptionManager.getActiveSubscriptionInfoList();
-    }
-
     private final SubscriptionManager.OnSubscriptionsChangedListener mOnSubscriptionsChangeListener
             = new SubscriptionManager.OnSubscriptionsChangedListener() {
         @Override
         public void onSubscriptionsChanged() {
             if (DBG) log("onSubscriptionsChanged:");
-            List<SubscriptionInfo> newSil = determineSubscriptionsToUse();
+            List<SubscriptionInfo> newSil = mSubscriptionManager.getActiveSubscriptionInfoList();
             if (DBG) log("onSubscriptionsChanged: newSil: " + newSil +
                     " mActiveSubInfos: " + mActiveSubInfos);
             if (newSil == null || newSil.isEmpty()) {
@@ -331,11 +309,15 @@ public class MobileNetworkSettings extends PreferenceActivity
 
         // Before updating the the active subscription list check
         // if tab updating is needed as the list is changing.
-        List<SubscriptionInfo> sil = determineSubscriptionsToUse();
+        List<SubscriptionInfo> sil = mSubscriptionManager.getActiveSubscriptionInfoList();
         // Display all tabs according to configuration in Multi Sim mode
         TelephonyManager tm = (TelephonyManager) getSystemService(
                 Context.TELEPHONY_SERVICE);
-        TabState state = isUpdateTabsNeeded(sil);
+        int phoneCount = tm.getPhoneCount();
+        TabState state = TabState.UPDATE;
+        if (phoneCount < 2) {
+            state = isUpdateTabsNeeded(sil);
+        }
 
         // Update to the active subscription list
         mActiveSubInfos.clear();
-- 
2.5.0

